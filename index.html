<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Number Plate Verification</title>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
</head>
<body>
  <h2>Number Plate Verification</h2>
  <img id="image" alt="Uploaded Image" style="max-width: 100%; height: auto;" />
  <p id="message" style="color: green; font-size: 20px;"></p>

  <script>
    const modelURL = "https://teachablemachine.withgoogle.com/models/GDWIDjNLs/model.json";
    const metadataURL = "https://teachablemachine.withgoogle.com/models/GDWIDjNLs/metadata.json";
    let model;

    async function loadModel() {
      model = await tmImage.load(modelURL, metadataURL);
      console.log("Model loaded");
    }

    async function predictImage() {
      if (!model) {
        console.error("Model not loaded yet!");
        return;
      }
      const image = document.getElementById("image");
      const prediction = await model.predict(image);

      let highest = prediction.reduce((prev, current) => (prev.probability > current.probability) ? prev : current);
      document.getElementById('message').innerText = `Result: ${highest.className} (${(highest.probability * 100).toFixed(2)}%)`;
    }

    function updateImage(base64Image) {
      if (base64Image) {
        document.getElementById('image').src = 'data:image/png;base64,' + base64Image;
        setTimeout(() => { predictImage(); }, 500);
      } else {
        document.getElementById('message').innerText = "No image data found.";
      }
    }

    let previousString = "";

    function checkWebViewStringUpdate() {
      if (window.AppInventor) {
        let currentString = window.AppInventor.getWebViewString();
        if (currentString && currentString !== previousString) {
          previousString = currentString;
          updateImage(currentString);
        }
      }
    }

    window.onload = function() {
      loadModel();
      setInterval(checkWebViewStringUpdate, 2000); // every 2 seconds check for new image
    }
  </script>
</body>
</html>
